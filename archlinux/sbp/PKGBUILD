# Maintainer: Batuhan Baserdem <baserdem.batuhan@gmail.com>
pkgbase='sbp'
pkgname=(
    'sbp-sys-base'
    'sbp-sys-extra'
    'sbp-sys-bios'
    'sbp-sys-uefi'
    'sbp-sys-virtual'
    'sbp-gui-base'
    'sbp-gui-extra'
    'sbp-gui-games'
    'sbp-gui-bspwm'
    'sbp-gui-sway'
    'sbp-cmp-homestation'
    'sbp-cmp-notebook'
    'sbp-cmp-server'
    'sbp-cmp-workstation')
pkgver=3.0
pkgrel=55
pkgdesc="Meta packages for sbp"
arch=('any')
url="https://github.com/bbaserdem/Etcfiles"
licence=(MIT)
validpgpkeys=('0B7151C823559DD8A7A04CE36426139E2F4C6CCE')
groups=('sbp')
source=(
    'base.chroot-os'
    'base.etckeeper'
    'base.install'
    'base.mpc-prev'
    'base.repo-build'
    'base.repo-remove'
    'base.repo-sync'
    'base.root-ssh'
    'uefi.install'
    'uefi.kernel-hook'
    'uefi.refind-hook'
    'uefi.refind-config'
    'uefi.refind-update'
    'uefi.sb-signscript'
    'gui.install'
    'gui.xinit-session'
    'homestation.hostname'
    'homestation.install'
    'homestation.refind'
    'notebook.hostname'
    'notebook.install'
    'server.hostname'
    'server.install'
    'virtual.install'
    'workstation.hostname'
    'workstation.install'
)

sha256sums=(SKIP SKIP SKIP SKIP
            SKIP SKIP SKIP SKIP
            SKIP SKIP SKIP SKIP
            SKIP SKIP SKIP SKIP
            SKIP SKIP SKIP SKIP
            SKIP SKIP SKIP SKIP
            SKIP SKIP)

package_sbp-sys-base() {
    install=base.install
    provides=('vim' 'vi' 'nano')
    conflicts=('vim' 'vi' 'nano')
    depends=('sbp-sys-boot')
    # Install user scripts
    install -dm 0755 "${pkgdir}/usr"
    install -dm 0755 "${pkgdir}/usr/bin"
    install -dm 0750 "${pkgdir}/root"
    install -dm 0700 "${pkgdir}/root/.ssh"
    install -Dm 0755 base.chroot-os     "${pkgdir}/usr/bin/chroot-os"
    install -Dm 0755 base.mpc-prev      "${pkgdir}/usr/bin/mpc-prev"
    install -Dm 0755 base.repo-remove   "${pkgdir}/usr/bin/archrepo-remove"
    install -Dm 0755 base.repo-sync     "${pkgdir}/usr/bin/archrepo-sync"
    install -Dm 0755 base.repo-build    "${pkgdir}/usr/bin/archrepo-build"
    install -Dm 0600 base.root-ssh      "${pkgdir}/root/.ssh/config"
    # Remove alternative editors
    ln -sf /usr/bin/nvim "${pkgdir}/usr/bin/vim"
    ln -sf /usr/bin/nvim "${pkgdir}/usr/bin/nano"
    ln -sf /usr/bin/nvim "${pkgdir}/usr/bin/vi"
    # Add powerlevel10k integration
    install -dm 0755 "${pkgdir}/usr/lib"
    install -dm 0755 "${pkgdir}/usr/lib/zim"
    install -dm 0755 "${pkgdir}/usr/lib/zim/modules"
    install -dm 0755 "${pkgdir}/usr/lib/zim/modules/prompt"
    install -dm 0755 "${pkgdir}/usr/lib/zim/modules/prompt/functions"
    install -dm 0755 "${pkgdir}/usr/lib/zim/modules/prompt/external-themes"
    ln -sf /usr/share/zsh-theme-powerlevel10k "${pkgdir}/usr/lib/zim/modules/prompt/external-themes/powerlevel10k"
    ln -sf /usr/lib/zim/modules/prompt/external-themes/powerlevel10k/powerlevel10k.zsh-theme "${pkgdir}/usr/lib/zim/modules/prompt/functions/prompt_powerlevel10k_setup"
    # Put pacman override to etckeeper config
    install -dm 0755 "${pkgdir}/etc"
    install -dm 0755 "${pkgdir}/etc/etckeeper"
    install -Dm 0755 base.etckeeper "${pkgdir}/etc/etckeeper/local.conf"
    
    #-----Packages
    depends+=(      # Gentoo has: baselayout
        'base'          # Arch meta-package
        'wget'
        'man-pages'
        'rsync'         # Gentoo has this on system
        'which'
        'gcc'
        'diffutils'
        'autoconf'      # Gentoo has gnuconf, probably analogues
        'patch'
        'device-mapper'
        'make'
        'less'
        'openssh'       # Gentoo has ssh on system
        'e2fsprogs'
        'inetutils'     # Gentoo has net-tools
        'binutils'
        'busybox'
        'kbd'           # NON-gentoo from here
        'automake' 'man-db' 'perl' 's-nail'
        'texinfo' 'usbutils' 'bison' 'fakeroot' 'flex' 'groff' 'libtool'
        'm4' 'pkgconf' )
    # Kernel and booting
    depends+=(
        'linux' 'linux-headers'
        'amd-ucode' 'intel-ucode'
        'linux-firmware'
        'dracut'
        'terminess-powerline-font-git')
    # File system stuff
    depends+=(
        'snapper'
        'parted'
        'btrfs-progs'
        'xfsprogs'
        'lvm2'
        'f2fs-tools'
        'fuse3'
        'jfsutils'
        'reiserfsprogs'
        'exfat-utils'
        'udftools'
        'udisks2')
    # Hardware
    depends+=( 
        'dmidecode'
        'hdparm'
        'i2c-tools'
        'lm_sensors'
        'lshw'
        'stress'
        'acpid'
        'cpupower'
        'powertop'
        'libinput')
    # Encryption
    depends+=(
        'pass' 'qrencode'
        'cryptsetup' 
        'gnupg'
        'openssh'
        'tor'
        'openconnect'
        'sshfs' 
        'openvpn' )
    # Network
    depends+=(
        'bind-tools'
        'openresolv'
        'firewalld'
        'nftables'
        'iptables'
        'openbsd-netcat'
        'unbound'
        'dhcpcd'
        'cups' 'cups-pdf' 'cups-pk-helper'
        'iwd'
        'bluez' 'bluez-libs' 'bluez-utils'
        'bridge-utils' 'hostapd'
        'nmap')
    # Administration
    depends+=(
        'logrotate'
        'sudo'
        'dbus'
        'etckeeper'
        'mlocate'
        'pam'
        'polkit'
        'inotify-tools'
        'fcron'
        'tzupdate'
        'lsb-release')
    # Arch stuff
    depends+=(
        'archiso' 
        'asp'
        'devtools'
        'reflector'
        'aurutils'
        'pacman-contrib' 
        'archlinux-appstream-data'
        'archlinux-keyring'
        'archlinux-xdg-menu'
        'sysfsutils')
    # Media
    depends+=(
        'alsa-utils' 'lib32-alsa-plugins'
        'pulseaudio' 'lib32-libpulse' 'pulseaudio-alsa' 'pulseaudio-bluetooth'
        'pamixer'
        'mpc' 'mpd' 
        'cdparanoia' )
    # Applications
    depends+=(
        'atool'
        'docker'
        'dash'
        'tmux'
        'htop'
        'neofetch'
        'neovim' 'python-neovim' 'python-pexpect' 'neovim-remote'
        'w3m'
        'pulsemixer'
        'vifm'
        'transmission-cli' )
    # Shell
    depends+=(
        'zsh'
        'zsh-zim-git'
        'zsh-theme-powerlevel10k'
        'zsh-theme-powerlevel10k'
        'spaceship-prompt')
    # Utilities
    depends+=(
        'bzip2' 'cpio' 'gzip' 'lhasa' 'lzop' 'p7zip' 'tar' 'unace' 'unrar'
        'unzip' 'xz' 'zip'
        'ctags'
        'bash-completion'
        'fzf'
        'git'
        'discount' 'jq' 'yajl'
        'msmtp'
        'xdg-user-dirs'
        'xdg-utils'
        'cmake' 'clang'
        's3cmd'
        'rasdaemon')
}

package_sbp-sys-extra() {
    depends=('sbp-sys-base')
    # Developement
    depends+=(
        'arm-none-eabi-gcc' 'arm-none-eabi-binutils' 'arm-none-eabi-newlib'
        'avr-binutils' 'avr-gcc' 'avr-libc' 'avrdude' 'dfu-util'
        'dfu-programmer' 'android-tools' 'android-udev' 'libmtp'
        'bpython'
        'lapack' 'openblas'
        'python-pip' 'python-pipenv' )
    # Utilities
    depends+=(
        'languagetool'
        'fluidsynth' 'lib32-fluidsynth'
        'flatpak'
        'trash-cli'
        'geoclue2'
        'imagemagick'
        )
    # Apps
    depends+=(
        'abcde'
        'neomutt' 'isync' 'notmuch'
        'ncmpcpp' 'mpdscribble'
        'khal' 'khard'
        'syncthing' 'syncthing-relaysrv'
        'youtube-dl'
        'newsboat'
        'todoman'
        'weechat' )
    # Other
    depends+=('private-internet-access-vpn')
}

package_sbp-sys-bios() {
    provides=('sbp-sys-boot')
    conflicts=('sbp-sys-uefi')
    depends=(
        'grub'
        'os-prober' )
}

package_sbp-sys-uefi() {
    provides=('sbp-sys-boot')
    conflicts=('sbp-sys-bios')
    install=uefi.install
    # Install refind config
    install -dm 0755 "${pkgdir}/esp"
    install -dm 0755 "${pkgdir}/esp/EFI"
    install -dm 0755 "${pkgdir}/esp/EFI/rEFInd"
    install -Dm 0755 uefi.refind-config "${pkgdir}/esp/EFI/rEFInd/refind.conf"
    # Install update hooks
    install -dm 0755 "${pkgdir}/usr"
    install -dm 0755 "${pkgdir}/usr/share"
    install -dm 0755 "${pkgdir}/usr/share/libalpm"
    install -dm 0755 "${pkgdir}/usr/share/libalpm/hooks"
    install -Dm 0755 uefi.kernel-hook   "${pkgdir}/usr/share/libalpm/hooks/99-linux-sb.hook"
    install -Dm 0755 uefi.refind-hook   "${pkgdir}/usr/share/libalpm/hooks/refind-sb.hook"
    # Install refind update script
    install -dm 0755 "${pkgdir}/usr/share/refind"
    install -Dm 0755 uefi.refind-update "${pkgdir}/usr/share/refind/update-refind.sh"
    # Install secure boot signing script
    install -dm 0755 "${pkgdir}/usr/bin"
    install -Dm 0755 uefi.sb-signscript "${pkgdir}/usr/bin/sbp-sbsign.sh"
    # Create directory for storing secure-boot keys
    install -dm 0755 "${pkgdir}/etc"
    install -dm 0755 "${pkgdir}/etc/keys"
    depends=(
        'efibootmgr'
        'efitools'
        'efivar'
        'refind-efi'
        'refind-theme-regular'
        'sbsigntools')
}

package_sbp-sys-virtual() {
    install=virtual.install
    depends=('sbp-sys-base')
    # Steam
    depends+=(
        'docker'
        'qemu'
        'vde2'
        'ovmf'
        'libvirt'
        'ebtables'
        'dnsmasq'
        'bridge-utils'
        'virt-manager'
        'virtio-win'
    )
}

package_sbp-gui-base() {
    # Install required stuff
    install -dm 0755 "${pkgdir}/usr/share/xsessions"
    install -Dm 0755 gui.xinit-session "${pkgdir}/usr/share/xsessions/xinitrc.desktop"
    install=gui.install
    # Dependencies
    depends=('sbp-sys-base')
    # Xorg stuff
    depends+=(
        'xorg-server'
        'xorg-setxkbmap'
        'xorg-xauth'
        'xorg-xev'
        'xorg-xinit'
        'xorg-xprop'
        'xorg-xrandr'
        'xorg-xrdb'
        'xorg-xset'
        'xorg-xsetroot'
        'xorg-xwininfo'
        'xdotool'
        'xkb-switch'
        'xorgproto' 'xf86-video-vesa' 'xorg-bdftopcf' 'xorg-docs'
        'xorg-font-util' 'xorg-fonts-encodings' 'xorg-iceauth' 'xorg-luit'
        'xorg-mkfontdir' 'xorg-mkfontscale' 'xorg-server-common'
        'xorg-server-devel' 'xorg-server-xdmx' 'xorg-server-xephyr'
        'xorg-server-xnest' 'xorg-server-xvfb'  'xorg-sessreg' 
        'xorg-smproxy' 'xorg-x11perf'  'xorg-xbacklight' 'xorg-xcmsdb'
        'xorg-xcursorgen' 'xorg-xdpyinfo' 'xorg-xdriinfo' 'xorg-xgamma'
        'xorg-xhost' 'xorg-xinput' 'xorg-xkbcomp' 'xorg-xkbevd' 'xorg-xkbutils'
        'xorg-xkill' 'xorg-xlsatoms' 'xorg-xlsclients' 'xorg-xmodmap' 'xorg-xpr'
        'xorg-xrefresh'  'xorg-xvinfo' 'xorg-xwd'  'xorg-xwud'
        'xf86-input-libinput'  'xorg-fonts-misc' 'xdo'  'xsel')
    # Wayland stuff
    depends+=(
        'wayland'
        'xorg-server-xwayland')
    # Login manager
    depends+=(
        'sddm'
        'chili-sddm-theme'
        'qt5-quickcontrols2')
    # Fonts
    depends+=(
        'nerd-fonts-source-code-pro'
        'adobe-source-serif-pro-fonts'
        'otf-nerd-fonts-fira-code'
        'terminus-font' 'terminus-font-otb'
        'noto-fonts-emoji'
        'termsyn-font'
        'ttf-droid'
        'ttf-inconsolata'
        'ibus' 'ibus-m17n'
        'ttf-iosevka')
    # Themes
    depends+=(
        'xcursor-comix'
        'arc-gtk-theme'
        'gnome-themes-extra'
        'kvantum-qt5' 'kvantum-theme-arc'
        'papirus-icon-theme')
    # Applications
    depends+=(
        'alacritty' 
        'blueman'
        'udiskie'
        'pavucontrol'
        'remmina' 'remmina-plugin-rdesktop' 'freerdp'
        'spyder'
        'imv'
        'zathura' 'zathura-cb' 'zathura-djvu' 'zathura-pdf-mupdf' 'zathura-ps'
        'smplayer'
        'firefox' 'flashplugin'
        'transmission-qt' 'transmission-remote-gtk')
    # Utilities
    depends+=(
        'gtk2fontsel' 'gucharmap'
        'system-config-printer'
        'perl-image-exiftool'       # For exif data on ranger
        'polkit-gnome'
        'mpv'
        'trezor-bridge-bin' )
    # Matlab dependencies
    depends+=(
        'gcc6'
        'gconf'
        'glu'
        'gstreamer0.10-base'
        'gtk2'
        'libunwind'
        'libxp'
        'libxp'
        'libxpm'
        'libxtst'
        'nss'
        'portaudio'
        'python2'
        'qt5-svg'
        'qt5-webkit'
        'qt5-websockets'
        'qt5-x11extras'
        'xerces-c'
        'jre8-openjdk'
        'jre10-openjdk' )
}

package_sbp-gui-extra() {
    depends=('sbp-gui-base')
    # Apps
    depends+=(
        'stellarium'
        'openscad'
        'kitty' 'python-pillow'
        'inkscape' 'python-lxml'
        'gimp'
        'blender'
        'darktable'
        'audacity'
        'virt-manager'
        'picard'
        'tuxguitar'
        'zotero'
        'pdfsam'
        'hamsket'
    )
    # Documents
    depends+=(
        'texlive-fontsextra' 'texlive-latexextra' 'texlive-pictures'
        'texlive-pstricks' 'texlive-core' 'texlive-science'
        'latex-mk' 'fontawesome.sty'
        'libreoffice-fresh')
    # Programming
    depends+=(
        'arduino'
        'arduino-avr-core'
        'octave' )
    # Utility
    depends+=(
        'syncthing-gtk'
        'dhcpcd-ui' )
}

package_sbp-gui-games() {
    depends=('sbp-gui-base')
    install -dm 0755 "${pkgdir}/opt"
    install -dm 0775 -g games "${pkgdir}/opt/steam"
    # Steam
    depends+=(
        'ttf-roboto' 'steam-fonts'
        'steamos-compositor-plus'
        'sssm' 'air-for-steam'
        'steam'
        'steam-native-runtime')
    # Wine
    depends+=(
        'wine-staging'                          # Windows compatibility
        'wine_gecko' 'wine-mono' 'lib32-libxml2' 'lib32-mpg123' 'lib32-lcms2'
        'lib32-giflib' 'lib32-libpng' 'lib32-gnutls' 'lib32-gst-plugins-base'
        'lib32-openal' 'lib32-gst-plugins-good' )
}


package_sbp-gui-bspwm() {
    depends=('sbp-gui-base')
    depends+=(
        'autorandr'             # Monitor management
        'light'                 # Brightness controls
        'bspwm'                 # Binary split partitioning WM
        'dex'                   # Autostart launcher
        'dunst'                 # Notification daemon
        'feh'                   # Wallpaper management
        'unclutter'             # Hide mouse when idle
        'i3lock'                # Screen locker
        'maim'                  # Screenshot utility
        'polybar'               # AUR: Status bar
        'redshift'              # Screen dimmer
        'rofi' 'rofi-pass'      # Application launcher
        'rofi-file-browser-extended'
        'sxhkd'                 # Simple X hotkey daemon
        'xfce4-power-manager'   # Battery notifications
        'xss-lock'              # Locks screen on power events
    )
}

package_sbp-gui-sway() {
    depends=('sbp-gui-base')
    depends+=(
        'light'                 # Brightness controls
        'dex'                   # Autostart launcher
        'grim'                  # Screenshot
        'i3blocks'              # Input to status-bar
        'mako'                  # Notification daemon
        'rofi'                  # App launcher
        'slurp'                 # Region selector
        'sway'                  # Wayland compositor
        'swayidle'              # Timout manager
        'swaylock'              # Screen-locker
        'wlroots'               # Wayland library
        'wl-clipboard'          # Clipboard utility
        'xfce4-power-manager'   # Battery notifications
    )
}

package_sbp-cmp-homestation() {
    provides=('sbp-cmp')
    conflicts=(
        'sbp-cmp-notebook'
        'sbp-cmp-workstation'
        'sbp-cmp-server' )
    install=homestation.install
    install -dm 0755 "${pkgdir}/etc"
    install -Dm 0644 homestation.hostname "${pkgdir}/etc/hostname"
    install -dm 0755 "${pkgdir}/boot"
    install -Dm 0755 homestation.refind   "${pkgdir}/boot/refind_linux.conf"
    depends=(                       # Graphics related
        'mesa'
        'mesa-demos'
        'mesa-vdpau'
        'libva-mesa-driver'
        'libva-vdpau-driver'
        'vulkan-radeon'
        'xf86-video-amdgpu'
        'lib32-mesa'                # Lib32 for required applications
        'lib32-mesa-demos' 
        'lib32-mesa-vdpau'
        'lib32-libva-mesa-driver'
        'lib32-vulkan-radeon')
    depends+=(
        'rtlwifi_new-extended-dkms' # Needed for wifi to work
        'nbfc'                      # Fan controls
    )
}

package_sbp-cmp-notebook() {
    provides=('sbp-cmp')
    conflicts=(
        'sbp-cmp-homestation'
        'sbp-cmp-workstation'
        'sbp-cmp-server' )
    install=notebook.install
    install -dm 0755 "${pkgdir}/etc"
    install -Dm 0644 notebook.hostname "${pkgdir}/etc/hostname"
    depends=(               # Graphics driver things
        'bbswitch-dkms'
        'nvidia-dkms'
        'nvidia-utils'
        'opencl-nvidia' 'cuda' 'gdb' 'ocl-icd'
        'mesa' 'lib32-mesa' 'mesa-demos' 'vulkan-intel'
    )
}

package_sbp-cmp-workstation() {
    provides=('sbp-cmp')
    conflicts=(
        'sbp-cmp-homestation'
        'sbp-cmp-notebook'
        'sbp-cmp-server' )
    install=workstation.install
    install -dm 0755 "${pkgdir}/etc"
    install -Dm 0644 workstation.hostname "${pkgdir}/etc/hostname"
    depends=(                   # Graphics drivers for RX 5800 XT
        'mesa-git'
        'amdvlk'
        'clang-git'
        'libclc-git'
        'libdrm-git'
        'llvm'
        'llvm-libs-git'
        'opencl-mesa-git'
        'vulkan-mesa-layer-git'
        'vulkan-radeon-git'
        'xf86-video-amdgpu-git'
        'lib32-mesa-git'
        'lib32-vulkan-radeon-git'
        'lib32-vulkan-mesa-layer-git')
    depends+=(
        'dropbox'                       # File synching
        'powerpanel' 'libusb-compat'    # UPS response
        )
}

package_sbp-cmp-server() {
    provides=('sbp-cmp')
    conflicts=(
        'sbp-cmp-homestation'
        'sbp-cmp-notebook'
        'sbp-cmp-workstation' )
    install=server.install
    install -dm 0755 "${pkgdir}/etc"
    install -Dm 0644 server.hostname "${pkgdir}/etc/hostname"
    #depends=(
    #    'apache'            # Web server
    #    'dovecot'           # IMAP email server
    #    'kodi'              # Media file server
    #    'mariadb'           # Database management
    #    'postfix'           # Mail transfer agent
    #    'rspamd'            # Spam filter for mail
    #    'transmission-cli'  # Torrenting
    #    'radicale'          # CalDAV and CardDAV server
    #)
}
