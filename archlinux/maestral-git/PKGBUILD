# Maintainer: Batuhan Baserdem <lastname dot firstname at gmail>

_name=maestral
pkgname="${_name}-git"
_srcname="${_name}-dropbox"
provides=("${_name}")
conflicts=("${_name}")
pkgver=0.2.3.27.g7717c64
pkgrel=2
pkgdesc='A light-weight and open-source Dropbox client.'
arch=('any')
url="https://github.com/SamSchott/${_srcname}"
license=('MIT')
source=("git+${url}.git")
makedepends=('git' 'python-setuptools' 'gendesk')
depends=(
    'python-blinker'
    'python-click'
    'python-dropbox'
    'python-keyrings-alt'
    'python-u-msgpack'
    'python-watchdog')
optdepends=('python-pyqt5: GUI support.')
md5sums=('SKIP')

prepare() {
    gendesk -q -n \
        --pkgname="${_name}" \
        --exec="${_name}-gui" \
        --comment="${pkgdesc}" \
        --categories=Network
}

pkgver() {
    cd "${srcdir}/${_srcname}"
    git describe --long --tags | sed 's|^v\(.*\)$|\1|g' | tr - .
}

build() {
    cd "${srcdir}/${_srcname}"
    python setup.py build
}

package() {
    cd "${srcdir}/${_srcname}"
    python setup.py install --root="${pkgdir}/" --optimize=1 --skip-build
    install -Dm644 "${srcdir}/${_name}.desktop" -t "${pkgdir}/usr/share/applications"
    install -Dm644 LICENSE.txt "${pkgdir}/usr/share/licenses/${_name}/LICENSE"
    install -Dm644 "${_name}/gui/resources/app_icon.svg" "${pkgdir}/usr/share/pixmaps/${_name}.svg"
}
