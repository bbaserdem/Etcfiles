# Maintainer:  Batuhan Baserdem <last dot first at gmail dot com>
# Based on the git PKGBUILD by; Dave Kleinschmidt <dave.f.kleinschmidt at gmail dot com>
pkgname='spaceship-prompt'
pkgdev='denysdovhan'
pkgver='v3.11.2'
pkgrel=1
pkgdesc='A Zsh prompt for Astronauts'
arch=('any')
url="https://${pkgdev}.com/${pkgname}/"
license=('MIT')
depends=('zsh')
#makedepends=('curl' 'jq')
install="${pkgname}.install"
source=("https://github.com/${pkgdev}/${pkgname}/archive/${pkgver}.tar.gz"
        "${pkgname}.install")
md5sums=('SKIP' 'SKIP')

#pkgver() {
#    # Get the latest release version from github
#    curl --silent "https://api.github.com/repos/${pkgdev}/${pkgname}/releases/latest" |
#    jq -r '."tag_name"'
#}

package() {
    _ver="$(echo ${pkgver} | sed 's|\(v*\)\(.*\)|\2|')"
    cd "${pkgname}-${_ver}"

    # Install the licences
    install -D -m644 LICENSE.md "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
    
    # Install the documentation
    install -D -m644 README.md "${pkgdir}/usr/share/doc/${pkgname}/README.md"
    find docs -type f -exec install -D -m644 {} "${pkgdir}/usr/share/doc/${pkgname}/{}" \;

    # Install the library files
    find lib -type f -exec install -D -m644 {} "${pkgdir}/usr/lib/${pkgname}/{}" \;
    find scripts -type f -exec install -D -m644 {} "${pkgdir}/usr/lib/${pkgname}/{}" \;
    find sections -type f -exec install -D -m644 {} "${pkgdir}/usr/lib/${pkgname}/{}" \;
    install -D -m644 spaceship.zsh "${pkgdir}/usr/lib/${pkgname}/spaceship.zsh"

    # Make symlinks
    ln -s spaceship.zsh "${pkgdir}/usr/lib/${pkgname}/spaceship.zsh-theme"

    # Put the theme in site-functions for integration
    install -d "${pkgdir}/usr/local/share/zsh/site-functions/"
    ln -s "/usr/lib/${pkgname}/spaceship.zsh" "${pkgdir}/usr/local/share/zsh/site-functions/prompt_spaceship_setup"
}
